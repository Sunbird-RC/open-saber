<html>

<head>
    <meta charset="UTF-8">
    <link type="text/css" rel="stylesheet"
        href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/todc-bootstrap/3.3.2-3.3.2/css/bootstrap-theme.min.css">
    <link rel="stylesheet" media="screen"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.min.css" />
    <link type="text/css" href="./css/alpaca.css" rel="stylesheet" />
    <link type="text/css" href="./css/person.css" rel="stylesheet" />
    
</head>

<body>
    <nav class="navbar navbar-default">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Open Saber</a>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                            aria-expanded="false"> English <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li class="active"><a class="dropdown-item active" href="./Person.html">English</a></li>
                            <li><a class="dropdown-item active" href="./Person-es.html">Spanish</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container" id="PersonForm"></div>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript"
        src="http://cdn.jsdelivr.net/npm/alpaca@1.5.27/dist/alpaca/bootstrap/alpaca.min.js"></script>
    <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript"
        src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
    <script type="text/javascript" src="http://code.cloudcms.com/alpaca/1.5.24/bootstrap/alpaca.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>


    <script type="text/javascript">
        $(document).ready(function () {
            var cookedVal = {
                "id": "",
                "ver": "1.0",
                "ets": "11234",
                "params": {
                    "did": "",
                    "key": "",
                    "msgid": ""
                },
                "request": { "Person": {} }
            };
            $("#PersonForm").alpaca({
                "schemaSource": "./schema/Person.json",
                "options": {
                    "validate": false,
                    "fields": {
                        "dob": {
                            "picker": {
                                "useCurrent": false,
                                "format": "YYYY-MM-DD",
                                "locale": "en_US",
                                "dayViewHeaderFormat": "MMMM YYYY",
                                "extraFormats": []
                            },
                            "manualEntry": false,
                        },
                        "photo": {
                            "type": "file",
                            "styled": true,
                            "type": "file",
                            "selectionHandler": function (files, data) {
                                var myArray = [];
                                var file = {};
                                for (var i = 0; i < files.length; i++) {
                                    file = {

                                        'name': files[i].name,
                                        'size': files[i].size,
                                        'type': files[i].type,
                                    }
                                    //add the file obj to your array
                                    myArray.push(file)
                                }
                                this.data = myArray;
                                console.log('this.data', this.data)
                            },

                        },

                    },
                    "form": {
                        "attributes": {
                            "method": "post",
                            "action": "http://localhost:8080/add"
                        },
                        "buttons": {
                            "add": {
                                "title": "Add",
                                "id": "sign",
                                "click": function () {
                                    var value = this.getValue();
                                    console.log(value, 'value')
                                    cookedVal["id"] = "open-saber.registry.create";
                                    if (value.photo) {
                                        var photo = value.photo[0];
                                        value.photo = photo.name
                                    }

                                    cookedVal["request"]["Person"] = value;
                                    console.log(JSON.stringify(cookedVal));

                                    $.ajax({
                                        url: "http://localhost:8080/add",
                                        type: "post",
                                        contentType: "application/json",
                                        data: JSON.stringify(cookedVal),
                                        success: function (data) {
                                            document.location.href = "./profile.html?osid=" + data.result.Person.osid;
                                        },
                                        error: function () {
                                            alert('error');
                                        }
                                    }
                                    );
                                }
                            }
                        }
                    },
                    "view": {
                        "parent": "bootstrap-edit-horizontal",
                        "layout": {
                            "template": './layout1.html',
                            "bindings": {
                                "nationalIdentifier": "leftcolumn",
                                "gender": "leftcolumn",
                                "name": "leftcolumn",
                                "isAdmin": "leftcolumn",
                                "phone": "leftcolumn",
                                "photo": "leftcolumn",
                                "dob": "leftcolumn",
                                "hasDrivingLicense": "leftcolumn"
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>

</html>